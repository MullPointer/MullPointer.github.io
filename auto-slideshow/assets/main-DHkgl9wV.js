var M=Object.defineProperty;var N=(t,n,e)=>n in t?M(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var u=(t,n,e)=>(N(t,typeof n!="symbol"?n+"":n,e),e);import{i as H,u as q,S as v,m as F,d as P}from"./utility-BmZmnbek.js";class m extends HTMLElement{constructor(){super(...arguments);u(this,"_imgInput",this.querySelector("input[type=image]"));u(this,"_imgURL","")}get slideText(){return this.querySelector("textarea").value}set slideText(e){this.querySelector("textarea").value=e}get imgURL(){return this._imgURL}set imgURL(e){this._imgURL=e,this._imgInput.src=e}get slideProps(){return{text:this.slideText,imgURL:this.imgURL}}set slideProps(e){this.slideText=e.text,this.imgURL=e.imgURL}nextSlide(){let e=this.nextElementSibling;for(;e instanceof HTMLElement&&e;){if(e instanceof m)return e;e=e.nextElementSibling}return null}previousSlide(){let e=this.previousElementSibling;for(;e instanceof HTMLElement&&e;){if(e instanceof m)return e;e=e.previousElementSibling}return null}}window.customElements.define("slide-section",m);const f=document.getElementById("image-select"),b=document.querySelector("#image-select form"),c=document.getElementById("image-select-gallery"),g=document.getElementById("image-select-URL-error"),r=document.getElementById("image-select-credit"),G="images/image-index.json";let o=null;(async()=>{const t=await fetch(G);t.ok?o=await t.json():console.error("Fetching image gallery failed with response: ",t)})();let d=null;function D(t,n){if(d=n,c.innerHTML="",E(null),o){for(const e of o){const l=document.createElement("input"),i=document.createElement("img"),s=document.createElement("label");s.className=c.dataset.classForLabel||"",l.type="radio",l.name="imageGallerySelect",l.value=e.URL,l.className="sr-only",i.title=e.Creator+`
`+e["Original Link"],i.src=e.Thumbnail,i.alt=e.Alt,i.className=c.dataset.classForImg||"",s.appendChild(l),s.appendChild(i),c.appendChild(s),e.URL===t&&(l.checked=!0,E(e.URL))}h("")}else h("Image gallery not loaded. Please try again.");f.showModal()}function h(t){g.innerText=t,t===""?g.classList.add("hidden"):g.classList.remove("hidden")}function E(t){let n=null;o&&(n=o.find(e=>e.URL===t)),n?(r.classList.remove("hidden"),r.innerHTML=`Selected image by <a href="${n["Original Link"]}" target='_blank' class='underline'>${n.Creator}</a>`):(r.classList.add("hidden"),r.innerHTML="")}document.getElementById("image-select").addEventListener("click",t=>{switch(t.target.dataset.ctrl){case"ok":const e=b.imageGallerySelect.value;H(e)?(d&&(d(e),d=null),f.close()):h("Image link not valid.");break;case"cancel":f.close();break}});document.getElementById("image-select").addEventListener("change",()=>{E(b.imageGallerySelect.value)});const L=document.getElementById("slides"),p="slide-section";let x=0;const _=document.getElementById("main-menu"),I=document.getElementById("main-menu-list"),a=document.getElementById("ctrl-menu");function j(){I.ariaHidden="false",a.ariaExpanded="true"}function y(){I.ariaHidden="true",a.ariaExpanded="false"}a.addEventListener("click",()=>{a.ariaExpanded==="true"?y():j()});_.addEventListener("keyup",t=>{a.ariaExpanded==="true"&&t.key==="Escape"&&y()});document.addEventListener("click",t=>{t.target.closest("#main-menu")||y()});document.getElementById("ctrl-slideshow-name").addEventListener("click",t=>{const e=t.currentTarget.querySelector("h1"),l=e.textContent;console.log("changing name");const i=document.createElement("input");for(const s of e.classList)i.classList.add(s);i.value=l,e.classList.add("hidden"),e.after(i),i.focus(),i.select(),i.addEventListener("blur",()=>{e.textContent=i.value,e.classList.remove("hidden"),i.remove()})});function R(){return document.querySelector("#ctrl-slideshow-name h1").textContent}function k(t){const n=document.querySelector("#ctrl-slideshow-name h1");n.textContent=t}document.getElementById("ctrl-watch").addEventListener("click",()=>{const t=B();window.open(t,"_blank")});document.getElementById("ctrl-make-link").addEventListener("click",()=>{const t=B();window.prompt("Shareable Link",t)});function B(){const t=U(),n=window.location.href.match(/^.+\//);if(n)return n[0]+"player.html?data="+encodeURIComponent(t);throw console.error("Could not find path from current page path",window.location.href),URIError("Could not find path from current page path")}document.getElementById("ctrl-import").addEventListener("click",async()=>{try{const t=await q();console.log("loading file ",t);const n=new v(t);O(),n.mapSlides(e=>S(null,e)),n.name?k(n.name):k("Untitled")}catch(t){const n=t instanceof Error?t.message:t;console.error("Failed to load file ",n),window.alert("Failed to load slideshow. Please confirm this is a valid slideshow file.")}});document.getElementById("ctrl-export").addEventListener("click",()=>{const t=U(),n=new Blob([t],{type:"application/xml"}),e=URL.createObjectURL(n),l=F(R(),"slideshow");P(e,l+".xml"),URL.revokeObjectURL(e)});document.getElementById("ctrl-about").addEventListener("click",()=>{const t=document.getElementById("about");document.getElementById("license").textContent===""&&setTimeout(async()=>{const n=await fetch("LICENSE");if(n.ok){const e=await n.text();document.getElementById("license").textContent=e}else console.error("Fetching license failed with response: ",n)}),t.showModal()});function U(){const t=new v;t.name=R();const n=document.querySelectorAll(p);for(const e of n){const l=e;t.appendSlide(l.slideProps)}return t.serialize()}document.getElementById("slides").addEventListener("click",t=>{const n=t.target,e=n.closest(p);console.log("control event ",n.dataset.ctrl);let l,i;switch(n.dataset.ctrl){case"img":D(e.imgURL,C=>{e.imgURL=C});break;case"up":l=e.previousSlide(),l&&L.insertBefore(e,l);break;case"down":i=e.nextSlide(),l=i?i.nextSlide():null,L.insertBefore(e,l);break;case"split":l=e.nextSlide();const s=e.slideText,w=e.querySelector("textarea").selectionStart;e.slideText=s.substring(0,w);const T=s.substring(w);S(l,{text:T,imgURL:e.imgURL});break;case"combine":l=e.previousSlide(),l&&(l.slideText+=`
`+e.slideText,e.remove());break;case"delete":e.remove();break}});document.getElementById("ctrl-add-slide").addEventListener("click",()=>{S()});function S(t=null,n={text:"",imgURL:""}){const i=document.querySelector("#template-slide-section").content.children[0].cloneNode(!0);x++,i.id="slide-"+x,L.insertBefore(i,t),i.slideProps=n}function O(){const t=document.querySelectorAll(p);for(const n of t)n.remove()}
