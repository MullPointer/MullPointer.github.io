var M=Object.defineProperty;var A=(t,n,e)=>n in t?M(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var p=(t,n,e)=>(A(t,typeof n!="symbol"?n+"":n,e),e);import{i as H,u as F,S as R,m as P,d as _}from"./utility-gbfQFRsr.js";class g extends HTMLElement{constructor(){super(...arguments);p(this,"_imgInput",this.querySelector("input[type=image]"));p(this,"_imgURL","")}get slideText(){return this.querySelector("textarea").value}set slideText(e){this.querySelector("textarea").value=e}get imgURL(){return this._imgURL}set imgURL(e){this._imgURL=e,this._imgInput.src=e}get imgAlt(){return this._imgInput.alt}set imgAlt(e){this._imgInput.alt=e}get slideProps(){return{text:this.slideText,imgURL:this.imgURL}}set slideProps(e){this.slideText=e.text,this.imgURL=e.imgURL}nextSlide(){let e=this.nextElementSibling;for(;e instanceof HTMLElement&&e;){if(e instanceof g)return e;e=e.nextElementSibling}return null}previousSlide(){let e=this.previousElementSibling;for(;e instanceof HTMLElement&&e;){if(e instanceof g)return e;e=e.previousElementSibling}return null}}window.customElements.define("slide-section",g);const b=document.getElementById("image-select"),U=document.querySelector("#image-select form"),d=document.getElementById("image-select-gallery"),L=document.getElementById("image-select-URL-error"),m=document.getElementById("image-select-credit"),D="images/image-index.json";let a=null;(async()=>{const t=await fetch(D);t.ok?a=await t.json():console.error("Fetching image gallery failed with response: ",t)})();let u=null;function G(t,n){if(u=n,d.innerHTML="",x(null),a){for(const e of a){const l=document.createElement("input"),i=document.createElement("img"),o=document.createElement("p"),s=document.createElement("label");s.className=d.dataset.classForLabel||"",l.type="radio",l.name="imageGallerySelect",l.value=e.URL,l.className="sr-only",i.title=e.Creator+`
`+e["Original Link"],i.src=e.Thumbnail,i.alt="",i.ariaHidden="true",i.className=d.dataset.classForImg||"",o.textContent=e.Alt,o.className="sr-only",s.appendChild(o),s.appendChild(l),s.appendChild(i),d.appendChild(s),e.URL===t&&(l.checked=!0,x(e.URL))}S("")}else S("Image gallery not loaded. Please try again.");b.showModal()}function S(t){L.innerText=t,t===""?L.classList.add("hidden"):L.classList.remove("hidden")}function x(t){let n=null;a&&(n=a.find(e=>e.URL===t)),n?(m.classList.remove("hidden"),m.innerHTML=`Selected image by <a href="${n["Original Link"]}" target='_blank' class='underline'>${n.Creator}</a>`):(m.classList.add("hidden"),m.innerHTML="")}function $(){const t=U.imageGallerySelect.value;let n=null,e="";a&&(n=a.find(l=>l.URL===t),n&&(e=n.Alt)),H(t)?(u&&(u(t,e),u=null),b.close()):S("Image link not valid.")}document.getElementById("image-select").addEventListener("click",t=>{switch(t.target.dataset.ctrl){case"ok":$();break;case"cancel":b.close();break}});document.getElementById("image-select").addEventListener("change",()=>{x(U.imageGallerySelect.value)});const w=document.getElementById("slides"),f="slide-section";let y=0;const j=document.getElementById("main-menu"),B=document.getElementById("main-menu-list"),r=document.getElementById("ctrl-menu");function O(){B.ariaHidden="false",r.ariaExpanded="true"}function k(){B.ariaHidden="true",r.ariaExpanded="false"}r.addEventListener("click",()=>{r.ariaExpanded==="true"?k():O()});j.addEventListener("keyup",t=>{r.ariaExpanded==="true"&&t.key==="Escape"&&k()});document.addEventListener("click",t=>{t.target.closest("#main-menu")||k()});document.getElementById("ctrl-slideshow-name").addEventListener("click",t=>{const e=t.currentTarget.querySelector("h1"),l=e.textContent;console.log("changing name");const i=document.createElement("input");for(const o of e.classList)i.classList.add(o);i.value=l,e.classList.add("hidden"),e.after(i),i.focus(),i.select(),i.addEventListener("blur",()=>{e.textContent=i.value,e.classList.remove("hidden"),i.remove()})});function T(){return document.querySelector("#ctrl-slideshow-name h1").textContent}function v(t){const n=document.querySelector("#ctrl-slideshow-name h1");n.textContent=t}document.getElementById("ctrl-watch").addEventListener("click",()=>{const t=C();window.open(t,"_blank")});document.getElementById("ctrl-make-link").addEventListener("click",()=>{const t=C();window.prompt("Shareable Link",t)});function C(){const t=N(),n=window.location.href.match(/^.+\//);if(n)return n[0]+"player.html?data="+encodeURIComponent(t);throw console.error("Could not find path from current page path",window.location.href),URIError("Could not find path from current page path")}document.getElementById("ctrl-import").addEventListener("click",async()=>{try{const t=await F();console.log("loading file ",t);const n=new R(t);z(),n.mapSlides(e=>I(null,e)),n.name?v(n.name):v("Untitled")}catch(t){const n=t instanceof Error?t.message:t;console.error("Failed to load file ",n),window.alert("Failed to load slideshow. Please confirm this is a valid slideshow file.")}});document.getElementById("ctrl-export").addEventListener("click",()=>{const t=N(),n=new Blob([t],{type:"application/xml"}),e=URL.createObjectURL(n),l=P(T(),"slideshow");_(e,l+".xml"),URL.revokeObjectURL(e)});document.getElementById("ctrl-about").addEventListener("click",()=>{const t=document.getElementById("about");document.getElementById("license").textContent===""&&setTimeout(async()=>{const n=await fetch("LICENSE");if(n.ok){const e=await n.text();document.getElementById("license").textContent=e}else console.error("Fetching license failed with response: ",n)}),t.showModal()});function N(){const t=new R;t.name=T();const n=document.querySelectorAll(f);for(const e of n){const l=e;t.appendSlide(l.slideProps)}return t.serialize()}document.getElementById("slides").addEventListener("click",t=>{const n=t.target,e=n.closest(f);console.log("control event ",n.dataset.ctrl);let l,i;switch(n.dataset.ctrl){case"img":G(e.imgURL,(E,q)=>{e.imgURL=E,e.imgAlt="Image - "+q});break;case"up":l=e.previousSlide(),l&&w.insertBefore(e,l),c();break;case"down":i=e.nextSlide(),l=i?i.nextSlide():null,w.insertBefore(e,l),c();break;case"split":l=e.nextSlide();const o=e.slideText,s=e.querySelector("textarea").selectionStart;e.slideText=o.substring(0,s);const h=o.substring(s);I(l,{text:h,imgURL:e.imgURL});break;case"combine":l=e.previousSlide(),l&&(l.slideText+=`
`+e.slideText,e.remove()),c();break;case"delete":e.remove(),c();break}});document.getElementById("ctrl-add-slide").addEventListener("click",()=>{I().querySelector("textarea").focus()});function I(t=null,n={text:"",imgURL:""}){const i=document.querySelector("#template-slide-section").content.children[0].cloneNode(!0);y++,i.id=`slide-${y}`,w.insertBefore(i,t),i.slideProps=n;const o=i.querySelector("h3"),s=`slide-label-${y}`;o.id=s,i.setAttribute("aria-labelledby",s),c();const h=i.querySelectorAll("input, textarea, button");for(const E of h)E.setAttribute("aria-describedby",s);return i}function z(){const t=document.querySelectorAll(f);for(const n of t)n.remove()}function c(){const t=document.querySelectorAll(f);let n=1;for(const e of t){const l=e.querySelector("h3");l.textContent=`Slide ${n}`,n++}}
